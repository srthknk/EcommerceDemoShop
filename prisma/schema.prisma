generator client {
    provider        = "prisma-client-js"
    previewFeatures = ["driverAdapters"]
}

datasource db {
    provider  = "postgresql"
    url       = env("DATABASE_URL")
    directUrl = env("DIRECT_URL")
}

// Required for creating a User: id, name, email, image, cart (optional JSON string)
model User {
    id    String @id
    name  String
    email String
    image String
    cart  Json   @default("{}")

    // Relations
    ratings     Rating[]
    Address     Address[]
    store       Store?
    buyerOrders Order[]   @relation("BuyerRelation")
}

enum ClothingSize {
    XS
    S
    M
    L
    XL
    XXL
    XXXL
}

// Required for creating a Product: name, description, mrp, price, images, category, storeId
model Product {
    id          String   @id @default(cuid())
    name        String
    description String
    mrp         Float
    price       Float
    images      String[]
    category    String
    inStock     Boolean  @default(true)
    storeId     String
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt
    isClothing  Boolean  @default(false)
    totalUnits  Int      @default(0)

    // Relations
    store      Store           @relation(fields: [storeId], references: [id], onDelete: Cascade)
    orderItems OrderItem[]
    rating     Rating[]
    productSizes ProductSize[]
    
    @@index([inStock])
    @@index([storeId])
    @@index([category])
    @@index([createdAt])
    @@index([isClothing])
}

// Product Size variant for clothing items
model ProductSize {
    id          String         @id @default(cuid())
    productId   String
    size        ClothingSize
    totalUnits  Int
    availableUnits Int
    createdAt   DateTime       @default(now())
    updatedAt   DateTime       @updatedAt

    // Relations
    product     Product        @relation(fields: [productId], references: [id], onDelete: Cascade)

    @@unique([productId, size])
    @@index([productId])
}

enum OrderStatus {
    ORDER_PLACED
    PROCESSING
    SHIPPED
    DELIVERED
    CANCELLED
}

enum CancellationReason {
    CHANGED_MIND
    FOUND_CHEAPER
    DONT_NEED_ANYMORE
    DELIVERY_LATE
    OTHER_REASON
    OUT_OF_STOCK
    INSUFFICIENT_QUANTITY
    PRODUCT_UNAVAILABLE
    QUALITY_ISSUE
    SELLER_REQUEST
}

enum PaymentMethod {
    COD
    RAZORPAY_CARD
    RAZORPAY_UPI
    RAZORPAY_WALLET
}

enum PaymentStatus {
    PENDING
    SUCCESS
    FAILED
    REFUNDED
}

// Required for creating an Order: total, userId, storeId, addressId, isPaid, paymentMethod, isCouponUsed, coupon (JSON), orderItems (nested)
model Order {
    id                    String                  @id @default(cuid())
    total                 Float
    status                OrderStatus             @default(ORDER_PLACED)
    userId                String
    storeId               String
    addressId             String
    isPaid                Boolean                 @default(false)
    paymentMethod         PaymentMethod
    paymentStatus         PaymentStatus           @default(PENDING)
    razorpayOrderId       String?                 // Razorpay order ID
    razorpayPaymentId     String?                 // Razorpay payment ID after successful payment
    razorpaySignature     String?                 // Razorpay signature for verification
    createdAt             DateTime                @default(now())
    updatedAt             DateTime                @updatedAt
    isCouponUsed          Boolean                 @default(false)
    coupon                Json                    @default("{}")
    orderItems            OrderItem[]
    isCancelled           Boolean                 @default(false)
    cancellationReason    CancellationReason?
    cancellationDescription String?
    cancelledBy           String?                 // "buyer" or "seller"
    cancelledAt           DateTime?

    // Relations
    user    User    @relation("BuyerRelation", fields: [userId], references: [id])
    store   Store   @relation(fields: [storeId], references: [id])
    address Address @relation(fields: [addressId], references: [id])
}

// Required for creating an OrderItem: orderId, productId, quantity, price
model OrderItem {
    orderId   String
    productId String
    quantity  Int
    price     Float
    selectedSize ClothingSize?

    // Relations
    order   Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
    product Product @relation(fields: [productId], references: [id])

    @@id([orderId, productId])
}

// Required for creating a Rating: rating, review, userId, productId
model Rating {
    id        String   @id @default(cuid())
    rating    Int
    review    String
    userId    String
    productId String
    orderId   String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    // Relations
    user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
    product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

    @@unique([userId, productId, orderId])
}

// Required for creating an Address: userId, name, email, street, city, state, zip, country, phone
model Address {
    id        String   @id @default(cuid())
    userId    String
    name      String
    email     String
    street    String
    city      String
    state     String
    zip       String
    country   String
    phone     String
    createdAt DateTime @default(now())

    // Relations
    Order Order[]
    user  User    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// Required for creating a Coupon: code, description, discount, forNewUser, isPublic, expiresAt
model Coupon {
    code        String   @id
    description String
    discount    Float
    forNewUser  Boolean
    forMember   Boolean  @default(false)
    isPublic    Boolean
    expiresAt   DateTime
    createdAt   DateTime @default(now())
}

// Required for creating a Store: userId, name, username, email, contact, logo, description, address (optional: , status, isActive)
model Store {
    id          String   @id @default(cuid())
    userId      String   @unique
    name        String
    description String
    username    String   @unique
    address     String
    status      String   @default("pending")
    isActive    Boolean  @default(false)
    logo        String
    email       String
    contact     String
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt

    Product Product[]
    Order   Order[]
    user    User      @relation(fields: [userId], references: [id])
    
    @@index([isActive])
    @@index([status])
    @@index([userId])
}

// Settings for store customization
model Settings {
    id              String   @id @default("default")
    storeName       String   @default("My Store")
    bannerImage1    String   @default("https://images.unsplash.com/photo-1517694712202-14dd9538aa97?w=1200")
    bannerImage2    String   @default("https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=1200")
    bannerImage3    String   @default("https://images.unsplash.com/photo-1491553895911-0055eca6402d?w=1200")
    bannerImage4    String   @default("")
    bannerImage5    String   @default("")
    bannerTitle1    String   @default("Best Products")
    bannerTitle2    String   @default("20% Discount")
    bannerTitle3    String   @default("New Arrivals")
    bannerTitle4    String   @default("")
    bannerTitle5    String   @default("")
    bannerLink1     String   @default("/shop")
    bannerLink2     String   @default("/shop")
    bannerLink3     String   @default("/shop")
    bannerLink4     String   @default("/shop")
    bannerLink5     String   @default("/shop")
    email           String   @default("contact@example.com")
    phone           String   @default("+1-212-456-7890")
    address         String   @default("794 Francisco, 94102")
    facebookUrl     String   @default("https://www.facebook.com")
    instagramUrl    String   @default("https://www.instagram.com")
    twitterUrl      String   @default("https://twitter.com")
    linkedinUrl     String   @default("https://www.linkedin.com")
    whatsappLink    String   @default("https://wa.me/")
    createdAt       DateTime @default(now())
    updatedAt       DateTime @updatedAt
}

// FAQ model for storing frequently asked questions
model FAQ {
    id        String   @id @default(cuid())
    question  String
    answer    String   @db.Text
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

